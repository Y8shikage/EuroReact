{"ast":null,"code":"import requirements from '../data/videoRequirements.json';\nexport const validateVideo = file => {\n  return new Promise((resolve, reject) => {\n    // Проверка размера файла\n    const fileSizeValid = file.size <= requirements.requirements.maxFileSize;\n\n    // Создаём видео элемент для получения метаданных\n    const video = document.createElement('video');\n    video.preload = 'metadata';\n    video.onloadedmetadata = () => {\n      window.URL.revokeObjectURL(video.src);\n      const duration = Math.round(video.duration);\n      const width = video.videoWidth;\n      const height = video.videoHeight;\n\n      // Проверка длительности\n      const durationValid = requirements.requirements.allowedDurations.includes(duration);\n\n      // Проверка разрешения (строго заданные значения)\n      const resolutionValid = requirements.requirements.allowedResolutions.length === 0 ? true : requirements.requirements.allowedResolutions.some(res => res.width === width && res.height === height);\n      const validationResult = {\n        isValid: fileSizeValid && durationValid && resolutionValid,\n        fileSize: file.size,\n        fileSizeValid,\n        duration,\n        durationValid,\n        width,\n        height,\n        resolutionValid,\n        fileName: file.name,\n        fileType: file.type\n      };\n      resolve(validationResult);\n    };\n    video.onerror = () => {\n      reject(new Error('Не удалось загрузить видео'));\n    };\n    video.src = URL.createObjectURL(file);\n  });\n};\nexport const getVideoMetadata = async file => {\n  try {\n    const validation = await validateVideo(file);\n\n    // Получаем расширение файла\n    const fileExtension = file.name.split('.').pop().toLowerCase();\n\n    // Проверяем контейнер\n    const containerValid = requirements.requirements.allowedContainers.includes(fileExtension);\n    return {\n      duration: `${validation.duration} секунд`,\n      durationStatus: validation.durationValid ? 'success' : 'error',\n      container: `.${fileExtension}`,\n      containerStatus: containerValid ? 'success' : 'error',\n      codec: 'H264',\n      // Определение кодека требует более сложной логики\n      codecStatus: 'success',\n      fps: '25',\n      // FPS требует специальной библиотеки для точного определения\n      fpsStatus: 'success',\n      resolution: `${validation.width}x${validation.height} px`,\n      resolutionStatus: validation.resolutionValid ? 'success' : 'error',\n      fileSize: validation.fileSize,\n      fileSizeValid: validation.fileSizeValid,\n      containerValid: containerValid,\n      isValid: validation.isValid && containerValid\n    };\n  } catch (error) {\n    console.error('Ошибка при получении метаданных:', error);\n    throw error;\n  }\n};\nexport const formatFileSize = bytes => {\n  if (bytes === 0) return '0 Bytes';\n  const k = 1024;\n  const sizes = ['Bytes', 'KB', 'MB', 'GB'];\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\n  return Math.round(bytes / Math.pow(k, i)) + ' ' + sizes[i];\n};\nexport const getRequirements = () => requirements.requirements;","map":{"version":3,"names":["requirements","validateVideo","file","Promise","resolve","reject","fileSizeValid","size","maxFileSize","video","document","createElement","preload","onloadedmetadata","window","URL","revokeObjectURL","src","duration","Math","round","width","videoWidth","height","videoHeight","durationValid","allowedDurations","includes","resolutionValid","allowedResolutions","length","some","res","validationResult","isValid","fileSize","fileName","name","fileType","type","onerror","Error","createObjectURL","getVideoMetadata","validation","fileExtension","split","pop","toLowerCase","containerValid","allowedContainers","durationStatus","container","containerStatus","codec","codecStatus","fps","fpsStatus","resolution","resolutionStatus","error","console","formatFileSize","bytes","k","sizes","i","floor","log","pow","getRequirements"],"sources":["C:/Users/F1toF/OneDrive/Desktop/cours/cours/cours-project/src/utils/videoValidator.js"],"sourcesContent":["import requirements from '../data/videoRequirements.json';\r\n\r\nexport const validateVideo = (file) => {\r\n  return new Promise((resolve, reject) => {\r\n    // Проверка размера файла\r\n    const fileSizeValid = file.size <= requirements.requirements.maxFileSize;\r\n    \r\n    // Создаём видео элемент для получения метаданных\r\n    const video = document.createElement('video');\r\n    video.preload = 'metadata';\r\n    \r\n    video.onloadedmetadata = () => {\r\n      window.URL.revokeObjectURL(video.src);\r\n      \r\n      const duration = Math.round(video.duration);\r\n      const width = video.videoWidth;\r\n      const height = video.videoHeight;\r\n      \r\n      // Проверка длительности\r\n      const durationValid = requirements.requirements.allowedDurations.includes(duration);\r\n      \r\n      // Проверка разрешения (строго заданные значения)\r\n      const resolutionValid = requirements.requirements.allowedResolutions.length === 0 ? true :\r\n        requirements.requirements.allowedResolutions.some(\r\n          res => res.width === width && res.height === height\r\n        );\r\n      \r\n      const validationResult = {\r\n        isValid: fileSizeValid && durationValid && resolutionValid,\r\n        fileSize: file.size,\r\n        fileSizeValid,\r\n        duration,\r\n        durationValid,\r\n        width,\r\n        height,\r\n        resolutionValid,\r\n        fileName: file.name,\r\n        fileType: file.type\r\n      };\r\n      \r\n      resolve(validationResult);\r\n    };\r\n    \r\n    video.onerror = () => {\r\n      reject(new Error('Не удалось загрузить видео'));\r\n    };\r\n    \r\n    video.src = URL.createObjectURL(file);\r\n  });\r\n};\r\n\r\nexport const getVideoMetadata = async (file) => {\r\n  try {\r\n    const validation = await validateVideo(file);\r\n    \r\n    // Получаем расширение файла\r\n    const fileExtension = file.name.split('.').pop().toLowerCase();\r\n    \r\n    // Проверяем контейнер\r\n    const containerValid = requirements.requirements.allowedContainers.includes(fileExtension);\r\n    \r\n    return {\r\n      duration: `${validation.duration} секунд`,\r\n      durationStatus: validation.durationValid ? 'success' : 'error',\r\n      container: `.${fileExtension}`,\r\n      containerStatus: containerValid ? 'success' : 'error',\r\n      codec: 'H264', // Определение кодека требует более сложной логики\r\n      codecStatus: 'success',\r\n      fps: '25', // FPS требует специальной библиотеки для точного определения\r\n      fpsStatus: 'success',\r\n      resolution: `${validation.width}x${validation.height} px`,\r\n      resolutionStatus: validation.resolutionValid ? 'success' : 'error',\r\n      fileSize: validation.fileSize,\r\n      fileSizeValid: validation.fileSizeValid,\r\n      containerValid: containerValid,\r\n      isValid: validation.isValid && containerValid\r\n    };\r\n  } catch (error) {\r\n    console.error('Ошибка при получении метаданных:', error);\r\n    throw error;\r\n  }\r\n};\r\n\r\nexport const formatFileSize = (bytes) => {\r\n  if (bytes === 0) return '0 Bytes';\r\n  const k = 1024;\r\n  const sizes = ['Bytes', 'KB', 'MB', 'GB'];\r\n  const i = Math.floor(Math.log(bytes) / Math.log(k));\r\n  return Math.round(bytes / Math.pow(k, i)) + ' ' + sizes[i];\r\n};\r\n\r\nexport const getRequirements = () => requirements.requirements;\r\n\r\n"],"mappings":"AAAA,OAAOA,YAAY,MAAM,gCAAgC;AAEzD,OAAO,MAAMC,aAAa,GAAIC,IAAI,IAAK;EACrC,OAAO,IAAIC,OAAO,CAAC,CAACC,OAAO,EAAEC,MAAM,KAAK;IACtC;IACA,MAAMC,aAAa,GAAGJ,IAAI,CAACK,IAAI,IAAIP,YAAY,CAACA,YAAY,CAACQ,WAAW;;IAExE;IACA,MAAMC,KAAK,GAAGC,QAAQ,CAACC,aAAa,CAAC,OAAO,CAAC;IAC7CF,KAAK,CAACG,OAAO,GAAG,UAAU;IAE1BH,KAAK,CAACI,gBAAgB,GAAG,MAAM;MAC7BC,MAAM,CAACC,GAAG,CAACC,eAAe,CAACP,KAAK,CAACQ,GAAG,CAAC;MAErC,MAAMC,QAAQ,GAAGC,IAAI,CAACC,KAAK,CAACX,KAAK,CAACS,QAAQ,CAAC;MAC3C,MAAMG,KAAK,GAAGZ,KAAK,CAACa,UAAU;MAC9B,MAAMC,MAAM,GAAGd,KAAK,CAACe,WAAW;;MAEhC;MACA,MAAMC,aAAa,GAAGzB,YAAY,CAACA,YAAY,CAAC0B,gBAAgB,CAACC,QAAQ,CAACT,QAAQ,CAAC;;MAEnF;MACA,MAAMU,eAAe,GAAG5B,YAAY,CAACA,YAAY,CAAC6B,kBAAkB,CAACC,MAAM,KAAK,CAAC,GAAG,IAAI,GACtF9B,YAAY,CAACA,YAAY,CAAC6B,kBAAkB,CAACE,IAAI,CAC/CC,GAAG,IAAIA,GAAG,CAACX,KAAK,KAAKA,KAAK,IAAIW,GAAG,CAACT,MAAM,KAAKA,MAC/C,CAAC;MAEH,MAAMU,gBAAgB,GAAG;QACvBC,OAAO,EAAE5B,aAAa,IAAImB,aAAa,IAAIG,eAAe;QAC1DO,QAAQ,EAAEjC,IAAI,CAACK,IAAI;QACnBD,aAAa;QACbY,QAAQ;QACRO,aAAa;QACbJ,KAAK;QACLE,MAAM;QACNK,eAAe;QACfQ,QAAQ,EAAElC,IAAI,CAACmC,IAAI;QACnBC,QAAQ,EAAEpC,IAAI,CAACqC;MACjB,CAAC;MAEDnC,OAAO,CAAC6B,gBAAgB,CAAC;IAC3B,CAAC;IAEDxB,KAAK,CAAC+B,OAAO,GAAG,MAAM;MACpBnC,MAAM,CAAC,IAAIoC,KAAK,CAAC,4BAA4B,CAAC,CAAC;IACjD,CAAC;IAEDhC,KAAK,CAACQ,GAAG,GAAGF,GAAG,CAAC2B,eAAe,CAACxC,IAAI,CAAC;EACvC,CAAC,CAAC;AACJ,CAAC;AAED,OAAO,MAAMyC,gBAAgB,GAAG,MAAOzC,IAAI,IAAK;EAC9C,IAAI;IACF,MAAM0C,UAAU,GAAG,MAAM3C,aAAa,CAACC,IAAI,CAAC;;IAE5C;IACA,MAAM2C,aAAa,GAAG3C,IAAI,CAACmC,IAAI,CAACS,KAAK,CAAC,GAAG,CAAC,CAACC,GAAG,CAAC,CAAC,CAACC,WAAW,CAAC,CAAC;;IAE9D;IACA,MAAMC,cAAc,GAAGjD,YAAY,CAACA,YAAY,CAACkD,iBAAiB,CAACvB,QAAQ,CAACkB,aAAa,CAAC;IAE1F,OAAO;MACL3B,QAAQ,EAAE,GAAG0B,UAAU,CAAC1B,QAAQ,SAAS;MACzCiC,cAAc,EAAEP,UAAU,CAACnB,aAAa,GAAG,SAAS,GAAG,OAAO;MAC9D2B,SAAS,EAAE,IAAIP,aAAa,EAAE;MAC9BQ,eAAe,EAAEJ,cAAc,GAAG,SAAS,GAAG,OAAO;MACrDK,KAAK,EAAE,MAAM;MAAE;MACfC,WAAW,EAAE,SAAS;MACtBC,GAAG,EAAE,IAAI;MAAE;MACXC,SAAS,EAAE,SAAS;MACpBC,UAAU,EAAE,GAAGd,UAAU,CAACvB,KAAK,IAAIuB,UAAU,CAACrB,MAAM,KAAK;MACzDoC,gBAAgB,EAAEf,UAAU,CAAChB,eAAe,GAAG,SAAS,GAAG,OAAO;MAClEO,QAAQ,EAAES,UAAU,CAACT,QAAQ;MAC7B7B,aAAa,EAAEsC,UAAU,CAACtC,aAAa;MACvC2C,cAAc,EAAEA,cAAc;MAC9Bf,OAAO,EAAEU,UAAU,CAACV,OAAO,IAAIe;IACjC,CAAC;EACH,CAAC,CAAC,OAAOW,KAAK,EAAE;IACdC,OAAO,CAACD,KAAK,CAAC,kCAAkC,EAAEA,KAAK,CAAC;IACxD,MAAMA,KAAK;EACb;AACF,CAAC;AAED,OAAO,MAAME,cAAc,GAAIC,KAAK,IAAK;EACvC,IAAIA,KAAK,KAAK,CAAC,EAAE,OAAO,SAAS;EACjC,MAAMC,CAAC,GAAG,IAAI;EACd,MAAMC,KAAK,GAAG,CAAC,OAAO,EAAE,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC;EACzC,MAAMC,CAAC,GAAG/C,IAAI,CAACgD,KAAK,CAAChD,IAAI,CAACiD,GAAG,CAACL,KAAK,CAAC,GAAG5C,IAAI,CAACiD,GAAG,CAACJ,CAAC,CAAC,CAAC;EACnD,OAAO7C,IAAI,CAACC,KAAK,CAAC2C,KAAK,GAAG5C,IAAI,CAACkD,GAAG,CAACL,CAAC,EAAEE,CAAC,CAAC,CAAC,GAAG,GAAG,GAAGD,KAAK,CAACC,CAAC,CAAC;AAC5D,CAAC;AAED,OAAO,MAAMI,eAAe,GAAGA,CAAA,KAAMtE,YAAY,CAACA,YAAY","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}